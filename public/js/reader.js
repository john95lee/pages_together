var book=ePub("./epub/charles-dickens_oliver-twist.epub"),rendition=book.renderTo("viewer",{width:"100%",height:600,spread:"always"});rendition.display(),rendition.on("relocated",(function(e){console.log(e);var t="rtl"===book.package.metadata.direction?document.getElementById("prev"):document.getElementById("next"),n="rtl"===book.package.metadata.direction?document.getElementById("next"):document.getElementById("prev");e.atEnd?t.style.visibility="hidden":t.style.visibility="visible",e.atStart?n.style.visibility="hidden":n.style.visibility="visible"})),rendition.on("layout",(function(e){let t=document.getElementById("viewer");e.spread?t.classList.remove("single"):t.classList.add("single")})),window.addEventListener("unload",(function(){console.log("unloading"),this.book.destroy()}));const getCfiFromHref=async e=>{const t=e.split("#")[1],n=book.spine.get(e);await n.load(book.load.bind(book));const o=t?n.document.getElementById(t):n.document.body;return n.cfiFromElement(o)};var chapNames=[],chapCFI=[];book.loaded.navigation.then((function(e,t){var n=document.getElementById("toc"),o=document.createDocumentFragment();e.forEach((function(e){var t=document.createElement("option");t.textContent=e.label,t.setAttribute("ref",e.href),chapNames.push(e.label),getCfiFromHref(e.href).then((function(e){chapCFI.push(e)})),o.appendChild(t)})),n.appendChild(o),n.onchange=function(){var e=n.selectedIndex,t=n.options[e].getAttribute("ref");return rendition.display(t),!1}})),console.log(chapNames),console.log(chapCFI),book.ready.then((function(){document.getElementById("next").addEventListener("click",(function(e){"rtl"===book.package.metadata.direction?rendition.prev():rendition.next(),e.preventDefault()}),!1),document.getElementById("prev").addEventListener("click",(function(e){"rtl"===book.package.metadata.direction?rendition.next():rendition.prev(),e.preventDefault()}),!1);var e=function(e){37==(e.keyCode||e.which)&&("rtl"===book.package.metadata.direction?rendition.next():rendition.prev()),39==(e.keyCode||e.which)&&("rtl"===book.package.metadata.direction?rendition.prev():rendition.next())};rendition.on("keyup",e),document.addEventListener("keyup",e,!1)})),book.locations.generate(1e3),console.log(book.locations.percentageFromCfi("epubcfi(/6/6[chapter-1.xhtml]!/")),rendition.on("selected",(function(e,t){console.log(e),console.log("start cfi: ",rendition.location.start.cfi),console.log("end cfi: ",rendition.location.end.cfi),rendition.annotations.highlight(e,{},e=>{}),t.window.getSelection().removeAllRanges()})),$((function(){$((function(){$('[data-toggle="tooltip"]').tooltip()})),$(".circle").mouseenter((function(){$(this).addClass("hover")})),$(".circle").mouseleave((function(){$(this).removeClass("hover")}))}));