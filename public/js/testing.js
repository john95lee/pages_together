var controls=document.getElementById("controls"),currentPage=document.getElementById("current-percent"),slider=document.createElement("input"),slide=function(){var e=book.locations.cfiFromPercentage(slider.value/100);rendition.display(e)},mouseDown=!1,book=ePub("./epub/charles-dickens_oliver-twist.epub"),rendition=book.renderTo("viewer",{width:"100%",height:600}),displayed=rendition.display(),title=document.getElementById("title"),next=document.getElementById("next");next.addEventListener("click",(function(e){rendition.next(),e.preventDefault()}),!1);var prev=document.getElementById("prev");prev.addEventListener("click",(function(e){rendition.prev(),e.preventDefault()}),!1);var keyListener=function(e){37==(e.keyCode||e.which)&&rendition.prev(),39==(e.keyCode||e.which)&&rendition.next()};rendition.on("keyup",keyListener),document.addEventListener("keyup",keyListener,!1);const getCfiFromHref=async e=>{const t=e.split("#")[1],n=book.spine.get(e);await n.load(book.load.bind(book));const o=t?n.document.getElementById(t):n.document.body;return n.cfiFromElement(o)};var chapNames=[],chapCFI=[];book.loaded.navigation.then((function(e){var t=document.getElementById("toc"),n=document.createDocumentFragment();e.forEach((function(e){var t=document.createElement("option");t.textContent=e.label,t.setAttribute("ref",e.href),chapNames.push(e.label),getCfiFromHref(e.href).then((function(e){chapCFI.push(e)})),n.appendChild(t)})),t.appendChild(n),t.onchange=function(){var e=t.selectedIndex,n=t.options[e].getAttribute("ref");return rendition.display(n),!1}})),console.log(chapCFI[1]),book.ready.then((function(){var e=book.key()+"-locations",t=localStorage.getItem(e);return t?book.locations.load(t):book.locations.generate(1600)})).then((function(e){controls.style.display="block",slider.setAttribute("type","range"),slider.setAttribute("min",0),slider.setAttribute("max",100),slider.setAttribute("step",1),slider.setAttribute("value",0),slider.addEventListener("change",slide,!1),slider.addEventListener("mousedown",(function(){mouseDown=!0}),!1),slider.addEventListener("mouseup",(function(){mouseDown=!1}),!1),displayed.then((function(){var e=rendition.currentLocation(),t=book.locations.percentageFromCfi(e.start.cfi);slider.value=t,t.value=t})),controls.appendChild(slider),currentPage.addEventListener("change",(function(){var e=book.locations.cfiFromPercentage(currentPage.value/100);rendition.display(e)}),!1),rendition.on("relocated",(function(e){var t=book.locations.percentageFromCfi(e.start.cfi),n=Math.floor(100*t);mouseDown||(slider.value=n),currentPage.value=n,console.log(e)})),localStorage.setItem(book.key()+"-locations",book.locations.save())}));